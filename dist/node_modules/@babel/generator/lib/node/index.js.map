{"version":3,"file":"index.js","names":["whitespace","require","parens","_t","FLIPPED_ALIAS_KEYS","isCallExpression","isExpressionStatement","isMemberExpression","isNewExpression","expandAliases","obj","map","Map","add","type","func","fn","get","set","node","parent","stack","_fn","_i","_Object$keys","Object","keys","length","aliases","_iterator","_createForOfIteratorHelper","_step","s","n","done","alias","value","err","e","f","expandedParens","expandedWhitespaceNodes","nodes","isOrHasCallExpression","object","needsWhitespace","_expandedWhitespaceNo","expression","flag","needsWhitespaceBefore","needsWhitespaceAfter","needsParens","printStack","_expandedParens$get","callee"],"sources":["../../src/node/index.ts"],"sourcesContent":["import * as whitespace from \"./whitespace.ts\";\nimport * as parens from \"./parentheses.ts\";\nimport {\n  FLIPPED_ALIAS_KEYS,\n  isCallExpression,\n  isExpressionStatement,\n  isMemberExpression,\n  isNewExpression,\n} from \"@babel/types\";\nimport type * as t from \"@babel/types\";\n\nimport type { WhitespaceFlag } from \"./whitespace.ts\";\n\ntype NodeHandler<R> = (\n  node: t.Node,\n  // todo:\n  // node: K extends keyof typeof t\n  //   ? Extract<typeof t[K], { type: \"string\" }>\n  //   : t.Node,\n  parent: t.Node,\n  stack?: t.Node[],\n) => R;\n\nexport type NodeHandlers<R> = {\n  [K in string]?: NodeHandler<R>;\n};\n\nfunction expandAliases<R>(obj: NodeHandlers<R>) {\n  const map = new Map<string, NodeHandler<R>>();\n\n  function add(type: string, func: NodeHandler<R>) {\n    const fn = map.get(type);\n    map.set(\n      type,\n      fn\n        ? function (node, parent, stack) {\n            return fn(node, parent, stack) ?? func(node, parent, stack);\n          }\n        : func,\n    );\n  }\n\n  for (const type of Object.keys(obj)) {\n    const aliases = FLIPPED_ALIAS_KEYS[type];\n    if (aliases) {\n      for (const alias of aliases) {\n        add(alias, obj[type]);\n      }\n    } else {\n      add(type, obj[type]);\n    }\n  }\n\n  return map;\n}\n\n// Rather than using `t.is` on each object property, we pre-expand any type aliases\n// into concrete types so that the 'find' call below can be as fast as possible.\nconst expandedParens = expandAliases(parens);\nconst expandedWhitespaceNodes = expandAliases(whitespace.nodes);\n\nfunction isOrHasCallExpression(node: t.Node): boolean {\n  if (isCallExpression(node)) {\n    return true;\n  }\n\n  return isMemberExpression(node) && isOrHasCallExpression(node.object);\n}\n\nexport function needsWhitespace(\n  node: t.Node,\n  parent: t.Node,\n  type: WhitespaceFlag,\n): boolean {\n  if (!node) return false;\n\n  if (isExpressionStatement(node)) {\n    node = node.expression;\n  }\n\n  const flag = expandedWhitespaceNodes.get(node.type)?.(node, parent);\n\n  if (typeof flag === \"number\") {\n    return (flag & type) !== 0;\n  }\n\n  return false;\n}\n\nexport function needsWhitespaceBefore(node: t.Node, parent: t.Node) {\n  return needsWhitespace(node, parent, 1);\n}\n\nexport function needsWhitespaceAfter(node: t.Node, parent: t.Node) {\n  return needsWhitespace(node, parent, 2);\n}\n\nexport function needsParens(\n  node: t.Node,\n  parent: t.Node,\n  printStack?: t.Node[],\n) {\n  if (!parent) return false;\n\n  if (isNewExpression(parent) && parent.callee === node) {\n    if (isOrHasCallExpression(node)) return true;\n  }\n\n  return expandedParens.get(node.type)?.(node, parent, printStack);\n}\n"],"mappings":"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","ignoreList":[]}