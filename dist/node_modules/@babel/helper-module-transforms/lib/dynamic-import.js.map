{"version":3,"file":"dynamic-import.js","names":["_core","require","exports","getDynamicImportSource","node","_node$arguments","_slicedToArray","arguments","source","types","isStringLiteral","isTemplateLiteral","template","expression","ast","_templateObject","_taggedTemplateLiteral","buildDynamicImport","deferToThen","wrapWithPromise","builder","specifier","isCallExpression","quasis","length","_templateObject2","specifierToString","identifier","templateLiteral","templateElement","raw","_templateObject3","_templateObject4","_templateObject5"],"sources":["../src/dynamic-import.ts"],"sourcesContent":["// Heavily inspired by\n// https://github.com/airbnb/babel-plugin-dynamic-import-node/blob/master/src/utils.js\n\nimport { types as t, template } from \"@babel/core\";\n\nif (!process.env.BABEL_8_BREAKING && !USE_ESM && !IS_STANDALONE) {\n  // eslint-disable-next-line no-restricted-globals\n  exports.getDynamicImportSource = function getDynamicImportSource(\n    node: t.CallExpression,\n  ): t.StringLiteral | t.TemplateLiteral {\n    const [source] = node.arguments;\n\n    return t.isStringLiteral(source) || t.isTemplateLiteral(source)\n      ? source\n      : (template.expression.ast`\\`\\${${source}}\\`` as t.TemplateLiteral);\n  };\n}\n\nexport function buildDynamicImport(\n  node: t.CallExpression | t.ImportExpression,\n  deferToThen: boolean,\n  wrapWithPromise: boolean,\n  builder: (specifier: t.Expression) => t.Expression,\n): t.Expression {\n  const specifier = t.isCallExpression(node) ? node.arguments[0] : node.source;\n\n  if (\n    t.isStringLiteral(specifier) ||\n    (t.isTemplateLiteral(specifier) && specifier.quasis.length === 0)\n  ) {\n    if (deferToThen) {\n      return template.expression.ast`\n        Promise.resolve().then(() => ${builder(specifier)})\n      `;\n    } else return builder(specifier);\n  }\n\n  const specifierToString = t.isTemplateLiteral(specifier)\n    ? t.identifier(\"specifier\")\n    : t.templateLiteral(\n        [t.templateElement({ raw: \"\" }), t.templateElement({ raw: \"\" })],\n        [t.identifier(\"specifier\")],\n      );\n\n  if (deferToThen) {\n    return template.expression.ast`\n      (specifier =>\n        new Promise(r => r(${specifierToString}))\n          .then(s => ${builder(t.identifier(\"s\"))})\n      )(${specifier})\n    `;\n  } else if (wrapWithPromise) {\n    return template.expression.ast`\n      (specifier =>\n        new Promise(r => r(${builder(specifierToString)}))\n      )(${specifier})\n    `;\n  } else {\n    return template.expression.ast`\n      (specifier => ${builder(specifierToString)})(${specifier})\n    `;\n  }\n}\n"],"mappings":";;;;;;;;;;;;;;AAGA,IAAAA,KAAA,GAAAC,OAAA;AAEiE;EAE/DC,OAAO,CAACC,sBAAsB,GAAG,SAASA,sBAAsBA,CAC9DC,IAAsB,EACe;IACrC,IAAAC,eAAA,GAAAC,cAAA,CAAiBF,IAAI,CAACG,SAAS;MAAxBC,MAAM,GAAAH,eAAA;IAEb,OAAOL,KAAA,CAAAS,KAAC,CAACC,eAAe,CAACF,MAAM,CAAC,IAAIR,KAAA,CAAAS,KAAC,CAACE,iBAAiB,CAACH,MAAM,CAAC,GAC3DA,MAAM,GACLR,KAAA,CAAAY,QAAQ,CAACC,UAAU,CAACC,GAAI,CAAAC,eAAA,KAAAA,eAAA,GAAAC,sBAAA,uCAAOR,MAAO,CAA0B;EACvE,CAAC;AACH;AAEO,SAASS,kBAAkBA,CAChCb,IAA2C,EAC3Cc,WAAoB,EACpBC,eAAwB,EACxBC,OAAkD,EACpC;EACd,IAAMC,SAAS,GAAGrB,KAAA,CAAAS,KAAC,CAACa,gBAAgB,CAAClB,IAAI,CAAC,GAAGA,IAAI,CAACG,SAAS,CAAC,CAAC,CAAC,GAAGH,IAAI,CAACI,MAAM;EAE5E,IACER,KAAA,CAAAS,KAAC,CAACC,eAAe,CAACW,SAAS,CAAC,IAC3BrB,KAAA,CAAAS,KAAC,CAACE,iBAAiB,CAACU,SAAS,CAAC,IAAIA,SAAS,CAACE,MAAM,CAACC,MAAM,KAAK,CAAE,EACjE;IACA,IAAIN,WAAW,EAAE;MACf,OAAOlB,KAAA,CAAAY,QAAQ,CAACC,UAAU,CAACC,GAAI,CAAAW,gBAAA,KAAAA,gBAAA,GAAAT,sBAAA,6DACEI,OAAO,CAACC,SAAS,CAAE;IAEtD,CAAC,MAAM,OAAOD,OAAO,CAACC,SAAS,CAAC;EAClC;EAEA,IAAMK,iBAAiB,GAAG1B,KAAA,CAAAS,KAAC,CAACE,iBAAiB,CAACU,SAAS,CAAC,GACpDrB,KAAA,CAAAS,KAAC,CAACkB,UAAU,CAAC,WAAW,CAAC,GACzB3B,KAAA,CAAAS,KAAC,CAACmB,eAAe,CACf,CAAC5B,KAAA,CAAAS,KAAC,CAACoB,eAAe,CAAC;IAAEC,GAAG,EAAE;EAAG,CAAC,CAAC,EAAE9B,KAAA,CAAAS,KAAC,CAACoB,eAAe,CAAC;IAAEC,GAAG,EAAE;EAAG,CAAC,CAAC,CAAC,EAChE,CAAC9B,KAAA,CAAAS,KAAC,CAACkB,UAAU,CAAC,WAAW,CAAC,CAC5B,CAAC;EAEL,IAAIT,WAAW,EAAE;IACf,OAAOlB,KAAA,CAAAY,QAAQ,CAACC,UAAU,CAACC,GAAI,CAAAiB,gBAAA,KAAAA,gBAAA,GAAAf,sBAAA,kHAENU,iBAAkB,EACxBN,OAAO,CAACpB,KAAA,CAAAS,KAAC,CAACkB,UAAU,CAAC,GAAG,CAAC,CAAE,EACxCN,SAAU;EAElB,CAAC,MAAM,IAAIF,eAAe,EAAE;IAC1B,OAAOnB,KAAA,CAAAY,QAAQ,CAACC,UAAU,CAACC,GAAI,CAAAkB,gBAAA,KAAAA,gBAAA,GAAAhB,sBAAA,sFAENI,OAAO,CAACM,iBAAiB,CAAE,EAC9CL,SAAU;EAElB,CAAC,MAAM;IACL,OAAOrB,KAAA,CAAAY,QAAQ,CAACC,UAAU,CAACC,GAAI,CAAAmB,gBAAA,KAAAA,gBAAA,GAAAjB,sBAAA,gDACbI,OAAO,CAACM,iBAAiB,CAAE,EAAIL,SAAU;EAE7D;AACF","ignoreList":[]}