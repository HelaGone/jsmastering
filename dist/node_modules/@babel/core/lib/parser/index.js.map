{"version":3,"file":"index.js","names":["_parser","data","require","_codeFrame","_missingPluginHelper","parser","pluginPasses","_ref","code","parserOpts","_ref$highlightCode","highlightCode","_ref$filename","filename","_regeneratorRuntime","mark","_callee","results","_iterator","_step","plugins","_iterator2","_step2","plugin","parserOverride","ast","loc","missingPlugin","codeFrame","wrap","_callee$","_context","prev","next","_createForOfIteratorHelper","s","n","done","value","parse","undefined","push","err","e","f","length","abrupt","delegateYield","then","Error","t1","message","codeFrameColumns","start","line","column","concat","stop"],"sources":["../../src/parser/index.ts"],"sourcesContent":["import type { Handler } from \"gensync\";\nimport { parse } from \"@babel/parser\";\nimport { codeFrameColumns } from \"@babel/code-frame\";\nimport generateMissingPluginMessage from \"./util/missing-plugin-helper.ts\";\nimport type { PluginPasses } from \"../config/index.ts\";\n\nexport type ParseResult = ReturnType<typeof parse>;\n\nexport default function* parser(\n  pluginPasses: PluginPasses,\n  { parserOpts, highlightCode = true, filename = \"unknown\" }: any,\n  code: string,\n): Handler<ParseResult> {\n  try {\n    const results = [];\n    for (const plugins of pluginPasses) {\n      for (const plugin of plugins) {\n        const { parserOverride } = plugin;\n        if (parserOverride) {\n          const ast = parserOverride(code, parserOpts, parse);\n\n          if (ast !== undefined) results.push(ast);\n        }\n      }\n    }\n\n    if (results.length === 0) {\n      return parse(code, parserOpts);\n    } else if (results.length === 1) {\n      // @ts-expect-error - If we want to allow async parsers\n      yield* [];\n      if (typeof results[0].then === \"function\") {\n        throw new Error(\n          `You appear to be using an async parser plugin, ` +\n            `which your current version of Babel does not support. ` +\n            `If you're using a published plugin, you may need to upgrade ` +\n            `your @babel/core version.`,\n        );\n      }\n      return results[0];\n    }\n    // TODO: Add an error code\n    throw new Error(\"More than one plugin attempted to override parsing.\");\n  } catch (err) {\n    if (err.code === \"BABEL_PARSER_SOURCETYPE_MODULE_REQUIRED\") {\n      err.message +=\n        \"\\nConsider renaming the file to '.mjs', or setting sourceType:module \" +\n        \"or sourceType:unambiguous in your Babel config for this file.\";\n      // err.code will be changed to BABEL_PARSE_ERROR later.\n    }\n\n    const { loc, missingPlugin } = err;\n    if (loc) {\n      const codeFrame = codeFrameColumns(\n        code,\n        {\n          start: {\n            line: loc.line,\n            column: loc.column + 1,\n          },\n        },\n        {\n          highlightCode,\n        },\n      );\n      if (missingPlugin) {\n        err.message =\n          `${filename}: ` +\n          generateMissingPluginMessage(\n            missingPlugin[0],\n            loc,\n            codeFrame,\n            filename,\n          );\n      } else {\n        err.message = `${filename}: ${err.message}\\n\\n` + codeFrame;\n      }\n      err.code = \"BABEL_PARSE_ERROR\";\n    }\n    throw err;\n  }\n}\n"],"mappings":";;;;;;;;;;;AACA,SAAAA,QAAA;EAAA,IAAAC,IAAA,GAAAC,OAAA;EAAAF,OAAA,YAAAA,QAAA;IAAA,OAAAC,IAAA;EAAA;EAAA,OAAAA,IAAA;AAAA;AACA,SAAAE,WAAA;EAAA,IAAAF,IAAA,GAAAC,OAAA;EAAAC,UAAA,YAAAA,WAAA;IAAA,OAAAF,IAAA;EAAA;EAAA,OAAAA,IAAA;AAAA;AACA,IAAAG,oBAAA,GAAAF,OAAA;AAKe,SAAUG,MAAMA,CAC7BC,YAA0B,EAAAC,IAAA,EAE1BC,IAAY;EAAA,IADVC,UAAU,GAAAF,IAAA,CAAVE,UAAU;IAAAC,kBAAA,GAAAH,IAAA,CAAEI,aAAa;IAAbA,aAAa,GAAAD,kBAAA,cAAG,IAAI,GAAAA,kBAAA;IAAAE,aAAA,GAAAL,IAAA,CAAEM,QAAQ;IAARA,QAAQ,GAAAD,aAAA,cAAG,YAAAA,aAAA;EAAA,oBAAAE,mBAAA,GAAAC,IAAA,UAAAC,QAAA;IAAA,IAAAC,OAAA,EAAAC,SAAA,EAAAC,KAAA,EAAAC,OAAA,EAAAC,UAAA,EAAAC,MAAA,EAAAC,MAAA,EAAAC,cAAA,EAAAC,GAAA,EAAAC,GAAA,EAAAC,aAAA,EAAAC,SAAA;IAAA,OAAAd,mBAAA,GAAAe,IAAA,UAAAC,SAAAC,QAAA;MAAA,kBAAAA,QAAA,CAAAC,IAAA,GAAAD,QAAA,CAAAE,IAAA;QAAA;UAAAF,QAAA,CAAAC,IAAA;UAIvCf,OAAO,GAAG,EAAE;UAAAC,SAAA,GAAAgB,0BAAA,CACI5B,YAAY;UAAA;YAAlC,KAAAY,SAAA,CAAAiB,CAAA,MAAAhB,KAAA,GAAAD,SAAA,CAAAkB,CAAA,IAAAC,IAAA,GAAoC;cAAzBjB,OAAO,GAAAD,KAAA,CAAAmB,KAAA;cAAAjB,UAAA,GAAAa,0BAAA,CACKd,OAAO;cAAA;gBAA5B,KAAAC,UAAA,CAAAc,CAAA,MAAAb,MAAA,GAAAD,UAAA,CAAAe,CAAA,IAAAC,IAAA,GAA8B;kBAAnBd,MAAM,GAAAD,MAAA,CAAAgB,KAAA;kBACPd,cAAA,GAAmBD,MAAM,CAAzBC,cAAA;kBACR,IAAIA,cAAc,EAAE;oBACZC,GAAG,GAAGD,cAAc,CAAChB,IAAI,EAAEC,UAAU,EAAET,OAAA,GAAAuC,KAAK,CAAC;oBAEnD,IAAId,GAAG,KAAKe,SAAS,EAAEvB,OAAO,CAACwB,IAAI,CAAChB,GAAG,CAAC;kBAC1C;gBACF;cAAA,SAAAiB,GAAA;gBAAArB,UAAA,CAAAsB,CAAA,CAAAD,GAAA;cAAA;gBAAArB,UAAA,CAAAuB,CAAA;cAAA;YACF;UAAA,SAAAF,GAAA;YAAAxB,SAAA,CAAAyB,CAAA,CAAAD,GAAA;UAAA;YAAAxB,SAAA,CAAA0B,CAAA;UAAA;UAAA,MAEI3B,OAAO,CAAC4B,MAAM,KAAK,CAAC;YAAAd,QAAA,CAAAE,IAAA;YAAA;UAAA;UAAA,OAAAF,QAAA,CAAAe,MAAA,WACf,IAAA9C,OAAA,GAAAuC,KAAK,EAAC/B,IAAI,EAAEC,UAAU,CAAC;QAAA;UAAA,MACrBQ,OAAO,CAAC4B,MAAM,KAAK,CAAC;YAAAd,QAAA,CAAAE,IAAA;YAAA;UAAA;UAE7B,OAAAF,QAAA,CAAAgB,aAAA,CAAO,EAAE;QAAA;UAAA,MACL,OAAO9B,OAAO,CAAC,CAAC,CAAC,CAAC+B,IAAI,KAAK,UAAU;YAAAjB,QAAA,CAAAE,IAAA;YAAA;UAAA;UAAA,MACjC,IAAIgB,KAAK,CACZ,4GACyD,iEACM,8BAElE,CAAC;QAAA;UAAA,OAAAlB,QAAA,CAAAe,MAAA,WAEI7B,OAAO,CAAC,CAAC,CAAC;QAAA;UAAA,MAGb,IAAIgC,KAAK,CAAC,qDAAqD,CAAC;QAAA;UAAAlB,QAAA,CAAAC,IAAA;UAAAD,QAAA,CAAAmB,EAAA,GAAAnB,QAAA;UAEtE,IAAIA,QAAA,CAAAmB,EAAA,CAAI1C,IAAI,KAAK,yCAAyC,EAAE;YAC1DuB,QAAA,CAAAmB,EAAA,CAAIC,OAAO,IACT,uEAAuE,GACvE,+DAA+D;UAEnE;UAEQzB,GAAG,GAAAK,QAAA,CAAAmB,EAAA,CAAHxB,GAAG,EAAEC,aAAA,GAAAI,QAAA,CAAAmB,EAAA,CAAAvB,aAAA;UACb,IAAID,GAAG,EAAE;YACDE,SAAS,GAAG,IAAAzB,UAAA,GAAAiD,gBAAgB,EAChC5C,IAAI,EACJ;cACE6C,KAAK,EAAE;gBACLC,IAAI,EAAE5B,GAAG,CAAC4B,IAAI;gBACdC,MAAM,EAAE7B,GAAG,CAAC6B,MAAM,GAAG;cACvB;YACF,CAAC,EACD;cACE5C,aAAA,EAAAA;YACF,CACF,CAAC;YACD,IAAIgB,aAAa,EAAE;cACjBI,QAAA,CAAAmB,EAAA,CAAIC,OAAO,GACR,GAAAK,MAAA,CAAE3C,QAAS,UACZ,IAAAT,oBAAA,WAA4B,EAC1BuB,aAAa,CAAC,CAAC,CAAC,EAChBD,GAAG,EACHE,SAAS,EACTf,QACF,CAAC;YACL,CAAC,MAAM;cACLkB,QAAA,CAAAmB,EAAA,CAAIC,OAAO,GAAI,GAAAK,MAAA,CAAE3C,QAAS,QAAA2C,MAAA,CAAIzB,QAAA,CAAAmB,EAAA,CAAIC,OAAQ,YAAQvB,SAAS;YAC7D;YACAG,QAAA,CAAAmB,EAAA,CAAI1C,IAAI,GAAG,mBAAmB;UAChC;UAAA,MAAAuB,QAAA,CAAAmB,EAAA;QAAA;QAAA;UAAA,OAAAnB,QAAA,CAAA0B,IAAA;MAAA;IAAA,GAAAzC,OAAA;EAAA;AAAA;AAGH","ignoreList":[]}