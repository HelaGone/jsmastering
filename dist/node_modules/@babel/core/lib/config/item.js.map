{"version":3,"file":"item.js","names":["_path","data","require","_configDescriptors","createItemFromDescriptor","desc","ConfigItem","createConfigItem","value","_ref","arguments","length","undefined","_ref$dirname","dirname","type","_regeneratorRuntime","mark","_callee","descriptor","wrap","_callee$","_context","prev","next","delegateYield","createDescriptor","resolve","alias","t0","abrupt","stop","CONFIG_ITEM_BRAND","Symbol","getItemDescriptor","item","_descriptor","_createClass","_classCallCheck","options","name","file","Object","defineProperty","enumerable","request","resolved","freeze","prototype"],"sources":["../../src/config/item.ts"],"sourcesContent":["import type { Handler } from \"gensync\";\nimport type { PluginTarget, PluginOptions } from \"./validation/options.ts\";\n\nimport path from \"path\";\nimport { createDescriptor } from \"./config-descriptors.ts\";\n\nimport type { UnloadedDescriptor } from \"./config-descriptors.ts\";\n\nexport function createItemFromDescriptor<API>(\n  desc: UnloadedDescriptor<API>,\n): ConfigItem<API> {\n  return new ConfigItem(desc);\n}\n\n/**\n * Create a config item using the same value format used in Babel's config\n * files. Items returned from this function should be cached by the caller\n * ideally, as recreating the config item will mean re-resolving the item\n * and re-evaluating the plugin/preset function.\n */\nexport function* createConfigItem<API>(\n  value:\n    | PluginTarget\n    | [PluginTarget, PluginOptions]\n    | [PluginTarget, PluginOptions, string | void],\n  {\n    dirname = \".\",\n    type,\n  }: {\n    dirname?: string;\n    type?: \"preset\" | \"plugin\";\n  } = {},\n): Handler<ConfigItem<API>> {\n  const descriptor = yield* createDescriptor(value, path.resolve(dirname), {\n    type,\n    alias: \"programmatic item\",\n  });\n\n  return createItemFromDescriptor(descriptor);\n}\n\nconst CONFIG_ITEM_BRAND = Symbol.for(\"@babel/core@7 - ConfigItem\");\n\nexport function getItemDescriptor<API>(\n  item: unknown,\n): UnloadedDescriptor<API> | void {\n  if ((item as any)?.[CONFIG_ITEM_BRAND]) {\n    return (item as ConfigItem<API>)._descriptor;\n  }\n\n  return undefined;\n}\n\nexport type { ConfigItem };\n\n/**\n * A public representation of a plugin/preset that will _eventually_ be load.\n * Users can use this to interact with the results of a loaded Babel\n * configuration.\n *\n * Any changes to public properties of this class should be considered a\n * breaking change to Babel's API.\n */\nclass ConfigItem<API> {\n  /**\n   * The private underlying descriptor that Babel actually cares about.\n   * If you access this, you are a bad person.\n   */\n  _descriptor: UnloadedDescriptor<API>;\n\n  // TODO(Babel 9): Check if this symbol needs to be updated\n  /**\n   * Used to detect ConfigItem instances from other Babel instances.\n   */\n  [CONFIG_ITEM_BRAND] = true;\n\n  /**\n   * The resolved value of the item itself.\n   */\n  value: {} | Function;\n\n  /**\n   * The options, if any, that were passed to the item.\n   * Mutating this will lead to undefined behavior.\n   *\n   * \"false\" means that this item has been disabled.\n   */\n  options: {} | void | false;\n\n  /**\n   * The directory that the options for this item are relative to.\n   */\n  dirname: string;\n\n  /**\n   * Get the name of the plugin, if the user gave it one.\n   */\n  name: string | void;\n\n  /**\n   * Data about the file that the item was loaded from, if Babel knows it.\n   */\n  file: {\n    // The requested path, e.g. \"@babel/env\".\n    request: string;\n    // The resolved absolute path of the file.\n    resolved: string;\n  } | void;\n\n  constructor(descriptor: UnloadedDescriptor<API>) {\n    // Make people less likely to stumble onto this if they are exploring\n    // programmatically, and also make sure that if people happen to\n    // pass the item through JSON.stringify, it doesn't show up.\n    this._descriptor = descriptor;\n    Object.defineProperty(this, \"_descriptor\", { enumerable: false });\n\n    Object.defineProperty(this, CONFIG_ITEM_BRAND, { enumerable: false });\n\n    this.value = this._descriptor.value;\n    this.options = this._descriptor.options;\n    this.dirname = this._descriptor.dirname;\n    this.name = this._descriptor.name;\n    this.file = this._descriptor.file\n      ? {\n          request: this._descriptor.file.request,\n          resolved: this._descriptor.file.resolved,\n        }\n      : undefined;\n\n    // Freeze the object to make it clear that people shouldn't expect mutating\n    // this object to do anything. A new item should be created if they want\n    // to change something.\n    Object.freeze(this);\n  }\n}\n\nObject.freeze(ConfigItem.prototype);\n"],"mappings":"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","ignoreList":[]}