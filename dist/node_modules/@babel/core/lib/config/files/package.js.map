{"version":3,"file":"package.js","names":["findPackageData","_typeof","o","Symbol","iterator","constructor","prototype","_path","data","require","_utils","_configError","PACKAGE_FILENAME","readConfigPackage","makeStaticFileCache","filepath","content","options","JSON","parse","err","concat","message","Error","Array","isArray","dirname","pkg","directories","isPackage","nextLoc","_regeneratorRuntime","wrap","findPackageData$","_context","prev","next","basename","push","delegateYield","join","t0","abrupt","stop","_marked"],"sources":["../../../src/config/files/package.ts"],"sourcesContent":["import path from \"path\";\nimport type { Handler } from \"gensync\";\nimport { makeStaticFileCache } from \"./utils.ts\";\n\nimport type { ConfigFile, FilePackageData } from \"./types.ts\";\n\nimport ConfigError from \"../../errors/config-error.ts\";\n\nconst PACKAGE_FILENAME = \"package.json\";\n\nconst readConfigPackage = makeStaticFileCache(\n  (filepath, content): ConfigFile => {\n    let options;\n    try {\n      options = JSON.parse(content) as unknown;\n    } catch (err) {\n      throw new ConfigError(\n        `Error while parsing JSON - ${err.message}`,\n        filepath,\n      );\n    }\n\n    if (!options) throw new Error(`${filepath}: No config detected`);\n\n    if (typeof options !== \"object\") {\n      throw new ConfigError(\n        `Config returned typeof ${typeof options}`,\n        filepath,\n      );\n    }\n    if (Array.isArray(options)) {\n      throw new ConfigError(`Expected config object but found array`, filepath);\n    }\n\n    return {\n      filepath,\n      dirname: path.dirname(filepath),\n      options,\n    };\n  },\n);\n\n/**\n * Find metadata about the package that this file is inside of. Resolution\n * of Babel's config requires general package information to decide when to\n * search for .babelrc files\n */\nexport function* findPackageData(filepath: string): Handler<FilePackageData> {\n  let pkg = null;\n  const directories = [];\n  let isPackage = true;\n\n  let dirname = path.dirname(filepath);\n  while (!pkg && path.basename(dirname) !== \"node_modules\") {\n    directories.push(dirname);\n\n    pkg = yield* readConfigPackage(path.join(dirname, PACKAGE_FILENAME));\n\n    const nextLoc = path.dirname(dirname);\n    if (dirname === nextLoc) {\n      isPackage = false;\n      break;\n    }\n    dirname = nextLoc;\n  }\n\n  return { filepath, directories, pkg, isPackage };\n}\n"],"mappings":"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","ignoreList":[]}