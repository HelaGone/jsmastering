{"version":3,"file":"transform.js","names":["_gensync","data","require","_index","_index2","_rewriteStackTrace","transformRunner","_regeneratorRuntime","mark","transform","code","opts","config","wrap","transform$","_context","prev","next","delegateYield","t0","abrupt","run","t1","stop","exports","optsOrCallback","maybeCallback","callback","undefined","beginHiddenCallStack","sync","errback","transformSync","apply","arguments","transformAsync","async"],"sources":["../src/transform.ts"],"sourcesContent":["import gensync, { type Handler } from \"gensync\";\n\nimport loadConfig from \"./config/index.ts\";\nimport type { InputOptions, ResolvedConfig } from \"./config/index.ts\";\nimport { run } from \"./transformation/index.ts\";\n\nimport type { FileResult, FileResultCallback } from \"./transformation/index.ts\";\nimport { beginHiddenCallStack } from \"./errors/rewrite-stack-trace.ts\";\n\nexport type { FileResult } from \"./transformation/index.ts\";\n\ntype Transform = {\n  (code: string, callback: FileResultCallback): void;\n  (\n    code: string,\n    opts: InputOptions | undefined | null,\n    callback: FileResultCallback,\n  ): void;\n  (code: string, opts?: InputOptions | null): FileResult | null;\n};\n\nconst transformRunner = gensync(function* transform(\n  code: string,\n  opts?: InputOptions,\n): Handler<FileResult | null> {\n  const config: ResolvedConfig | null = yield* loadConfig(opts);\n  if (config === null) return null;\n\n  return yield* run(config, code);\n});\n\nexport const transform: Transform = function transform(\n  code,\n  optsOrCallback?: InputOptions | null | undefined | FileResultCallback,\n  maybeCallback?: FileResultCallback,\n) {\n  let opts: InputOptions | undefined | null;\n  let callback: FileResultCallback | undefined;\n  if (typeof optsOrCallback === \"function\") {\n    callback = optsOrCallback;\n    opts = undefined;\n  } else {\n    opts = optsOrCallback;\n    callback = maybeCallback;\n  }\n\n  if (callback === undefined) {\n    if (process.env.BABEL_8_BREAKING) {\n      throw new Error(\n        \"Starting from Babel 8.0.0, the 'transform' function expects a callback. If you need to call it synchronously, please use 'transformSync'.\",\n      );\n    } else {\n      // console.warn(\n      //   \"Starting from Babel 8.0.0, the 'transform' function will expect a callback. If you need to call it synchronously, please use 'transformSync'.\",\n      // );\n      return beginHiddenCallStack(transformRunner.sync)(code, opts);\n    }\n  }\n\n  beginHiddenCallStack(transformRunner.errback)(code, opts, callback);\n};\n\nexport function transformSync(\n  ...args: Parameters<typeof transformRunner.sync>\n) {\n  return beginHiddenCallStack(transformRunner.sync)(...args);\n}\nexport function transformAsync(\n  ...args: Parameters<typeof transformRunner.async>\n) {\n  return beginHiddenCallStack(transformRunner.async)(...args);\n}\n"],"mappings":";;;;;;;;;;AAAA,SAAAA,SAAA;EAAA,IAAAC,IAAA,GAAAC,OAAA;EAAAF,QAAA,YAAAA,SAAA;IAAA,OAAAC,IAAA;EAAA;EAAA,OAAAA,IAAA;AAAA;AAEA,IAAAE,MAAA,GAAAD,OAAA;AAEA,IAAAE,OAAA,GAAAF,OAAA;AAGA,IAAAG,kBAAA,GAAAH,OAAA;AAcA,IAAMI,eAAe,GAAGN,QAAA,CAAM,CAAC,eAAAO,mBAAA,GAAAC,IAAA,CAAC,SAAUC,SAASA,CACjDC,IAAY,EACZC,IAAmB;EAAA,IAAAC,MAAA;EAAA,OAAAL,mBAAA,GAAAM,IAAA,UAAAC,WAAAC,QAAA;IAAA,kBAAAA,QAAA,CAAAC,IAAA,GAAAD,QAAA,CAAAE,IAAA;MAAA;QAEmB,OAAAF,QAAA,CAAAG,aAAA,CAAO,IAAAf,MAAA,WAAU,EAACQ,IAAI,CAAC;MAAA;QAAvDC,MAA6B,GAAAG,QAAA,CAAAI,EAAA;QAAA,MAC/BP,MAAM,KAAK,IAAI;UAAAG,QAAA,CAAAE,IAAA;UAAA;QAAA;QAAA,OAAAF,QAAA,CAAAK,MAAA,WAAS,IAAI;MAAA;QAEzB,OAAAL,QAAA,CAAAG,aAAA,CAAO,IAAAd,OAAA,CAAAiB,GAAG,EAACT,MAAM,EAAEF,IAAI,CAAC;MAAA;QAAA,OAAAK,QAAA,CAAAK,MAAA,WAAAL,QAAA,CAAAO,EAAA;MAAA;MAAA;QAAA,OAAAP,QAAA,CAAAQ,IAAA;IAAA;EAAA,GAPSd,SAAS;AAAA,CAQlD,EAAC;AAEK,IAAMA,SAAoB,GAAAe,OAAA,CAAAf,SAAA,GAAG,SAASA,SAASA,CACpDC,IAAI,EACJe,cAAqE,EACrEC,aAAkC,EAClC;EACA,IAAIf,IAAqC;EACzC,IAAIgB,QAAwC;EAC5C,IAAI,OAAOF,cAAc,KAAK,UAAU,EAAE;IACxCE,QAAQ,GAAGF,cAAc;IACzBd,IAAI,GAAGiB,SAAS;EAClB,CAAC,MAAM;IACLjB,IAAI,GAAGc,cAAc;IACrBE,QAAQ,GAAGD,aAAa;EAC1B;EAEA,IAAIC,QAAQ,KAAKC,SAAS,EAAE;IAKnB;MAIL,OAAO,IAAAvB,kBAAA,CAAAwB,oBAAoB,EAACvB,eAAe,CAACwB,IAAI,CAAC,CAACpB,IAAI,EAAEC,IAAI,CAAC;IAC/D;EACF;EAEA,IAAAN,kBAAA,CAAAwB,oBAAoB,EAACvB,eAAe,CAACyB,OAAO,CAAC,CAACrB,IAAI,EAAEC,IAAI,EAAEgB,QAAQ,CAAC;AACrE,CAAC;AAEM,SAASK,aAAaA,CAAA,EAE3B;EACA,OAAO,IAAA3B,kBAAA,CAAAwB,oBAAoB,EAACvB,eAAe,CAACwB,IAAI,CAAC,CAAAG,KAAA,SAAAC,SAAQ,CAAC;AAC5D;AACO,SAASC,cAAcA,CAAA,EAE5B;EACA,OAAO,IAAA9B,kBAAA,CAAAwB,oBAAoB,EAACvB,eAAe,CAAC8B,KAAK,CAAC,CAAAH,KAAA,SAAAC,SAAQ,CAAC;AAC7D;AAAC","ignoreList":[]}