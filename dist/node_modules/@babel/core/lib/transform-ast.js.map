{"version":3,"file":"transform-ast.js","names":["_gensync","data","require","_index","_index2","_rewriteStackTrace","transformFromAstRunner","_regeneratorRuntime","mark","_callee","ast","code","opts","config","wrap","_callee$","_context","prev","next","delegateYield","t0","abrupt","Error","run","t1","stop","transformFromAst","exports","optsOrCallback","maybeCallback","callback","undefined","beginHiddenCallStack","sync","errback","transformFromAstSync","apply","arguments","transformFromAstAsync","async"],"sources":["../src/transform-ast.ts"],"sourcesContent":["import gensync, { type Handler } from \"gensync\";\n\nimport loadConfig from \"./config/index.ts\";\nimport type { InputOptions, ResolvedConfig } from \"./config/index.ts\";\nimport { run } from \"./transformation/index.ts\";\nimport type * as t from \"@babel/types\";\n\nimport { beginHiddenCallStack } from \"./errors/rewrite-stack-trace.ts\";\n\nimport type { FileResult, FileResultCallback } from \"./transformation/index.ts\";\ntype AstRoot = t.File | t.Program;\n\ntype TransformFromAst = {\n  (ast: AstRoot, code: string, callback: FileResultCallback): void;\n  (\n    ast: AstRoot,\n    code: string,\n    opts: InputOptions | undefined | null,\n    callback: FileResultCallback,\n  ): void;\n  (ast: AstRoot, code: string, opts?: InputOptions | null): FileResult | null;\n};\n\nconst transformFromAstRunner = gensync(function* (\n  ast: AstRoot,\n  code: string,\n  opts: InputOptions | undefined | null,\n): Handler<FileResult | null> {\n  const config: ResolvedConfig | null = yield* loadConfig(opts);\n  if (config === null) return null;\n\n  if (!ast) throw new Error(\"No AST given\");\n\n  return yield* run(config, code, ast);\n});\n\nexport const transformFromAst: TransformFromAst = function transformFromAst(\n  ast,\n  code,\n  optsOrCallback?: InputOptions | null | undefined | FileResultCallback,\n  maybeCallback?: FileResultCallback,\n) {\n  let opts: InputOptions | undefined | null;\n  let callback: FileResultCallback | undefined;\n  if (typeof optsOrCallback === \"function\") {\n    callback = optsOrCallback;\n    opts = undefined;\n  } else {\n    opts = optsOrCallback;\n    callback = maybeCallback;\n  }\n\n  if (callback === undefined) {\n    if (process.env.BABEL_8_BREAKING) {\n      throw new Error(\n        \"Starting from Babel 8.0.0, the 'transformFromAst' function expects a callback. If you need to call it synchronously, please use 'transformFromAstSync'.\",\n      );\n    } else {\n      // console.warn(\n      //   \"Starting from Babel 8.0.0, the 'transformFromAst' function will expect a callback. If you need to call it synchronously, please use 'transformFromAstSync'.\",\n      // );\n      return beginHiddenCallStack(transformFromAstRunner.sync)(ast, code, opts);\n    }\n  }\n\n  beginHiddenCallStack(transformFromAstRunner.errback)(\n    ast,\n    code,\n    opts,\n    callback,\n  );\n};\n\nexport function transformFromAstSync(\n  ...args: Parameters<typeof transformFromAstRunner.sync>\n) {\n  return beginHiddenCallStack(transformFromAstRunner.sync)(...args);\n}\n\nexport function transformFromAstAsync(\n  ...args: Parameters<typeof transformFromAstRunner.async>\n) {\n  return beginHiddenCallStack(transformFromAstRunner.async)(...args);\n}\n"],"mappings":";;;;;;;;;;AAAA,SAAAA,SAAA;EAAA,IAAAC,IAAA,GAAAC,OAAA;EAAAF,QAAA,YAAAA,SAAA;IAAA,OAAAC,IAAA;EAAA;EAAA,OAAAA,IAAA;AAAA;AAEA,IAAAE,MAAA,GAAAD,OAAA;AAEA,IAAAE,OAAA,GAAAF,OAAA;AAGA,IAAAG,kBAAA,GAAAH,OAAA;AAgBA,IAAMI,sBAAsB,GAAGN,QAAA,CAAM,CAAC,eAAAO,mBAAA,GAAAC,IAAA,CAAC,SAAAC,QACrCC,GAAY,EACZC,IAAY,EACZC,IAAqC;EAAA,IAAAC,MAAA;EAAA,OAAAN,mBAAA,GAAAO,IAAA,UAAAC,SAAAC,QAAA;IAAA,kBAAAA,QAAA,CAAAC,IAAA,GAAAD,QAAA,CAAAE,IAAA;MAAA;QAEC,OAAAF,QAAA,CAAAG,aAAA,CAAO,IAAAhB,MAAA,WAAU,EAACS,IAAI,CAAC;MAAA;QAAvDC,MAA6B,GAAAG,QAAA,CAAAI,EAAA;QAAA,MAC/BP,MAAM,KAAK,IAAI;UAAAG,QAAA,CAAAE,IAAA;UAAA;QAAA;QAAA,OAAAF,QAAA,CAAAK,MAAA,WAAS,IAAI;MAAA;QAAA,IAE3BX,GAAG;UAAAM,QAAA,CAAAE,IAAA;UAAA;QAAA;QAAA,MAAQ,IAAII,KAAK,CAAC,cAAc,CAAC;MAAA;QAElC,OAAAN,QAAA,CAAAG,aAAA,CAAO,IAAAf,OAAA,CAAAmB,GAAG,EAACV,MAAM,EAAEF,IAAI,EAAED,GAAG,CAAC;MAAA;QAAA,OAAAM,QAAA,CAAAK,MAAA,WAAAL,QAAA,CAAAQ,EAAA;MAAA;MAAA;QAAA,OAAAR,QAAA,CAAAS,IAAA;IAAA;EAAA,GAAAhB,OAAA;AAAA,CACrC,EAAC;AAEK,IAAMiB,gBAAkC,GAAAC,OAAA,CAAAD,gBAAA,GAAG,SAASA,gBAAgBA,CACzEhB,GAAG,EACHC,IAAI,EACJiB,cAAqE,EACrEC,aAAkC,EAClC;EACA,IAAIjB,IAAqC;EACzC,IAAIkB,QAAwC;EAC5C,IAAI,OAAOF,cAAc,KAAK,UAAU,EAAE;IACxCE,QAAQ,GAAGF,cAAc;IACzBhB,IAAI,GAAGmB,SAAS;EAClB,CAAC,MAAM;IACLnB,IAAI,GAAGgB,cAAc;IACrBE,QAAQ,GAAGD,aAAa;EAC1B;EAEA,IAAIC,QAAQ,KAAKC,SAAS,EAAE;IAKnB;MAIL,OAAO,IAAA1B,kBAAA,CAAA2B,oBAAoB,EAAC1B,sBAAsB,CAAC2B,IAAI,CAAC,CAACvB,GAAG,EAAEC,IAAI,EAAEC,IAAI,CAAC;IAC3E;EACF;EAEA,IAAAP,kBAAA,CAAA2B,oBAAoB,EAAC1B,sBAAsB,CAAC4B,OAAO,CAAC,CAClDxB,GAAG,EACHC,IAAI,EACJC,IAAI,EACJkB,QACF,CAAC;AACH,CAAC;AAEM,SAASK,oBAAoBA,CAAA,EAElC;EACA,OAAO,IAAA9B,kBAAA,CAAA2B,oBAAoB,EAAC1B,sBAAsB,CAAC2B,IAAI,CAAC,CAAAG,KAAA,SAAAC,SAAQ,CAAC;AACnE;AAEO,SAASC,qBAAqBA,CAAA,EAEnC;EACA,OAAO,IAAAjC,kBAAA,CAAA2B,oBAAoB,EAAC1B,sBAAsB,CAACiC,KAAK,CAAC,CAAAH,KAAA,SAAAC,SAAQ,CAAC;AACpE;AAAC","ignoreList":[]}